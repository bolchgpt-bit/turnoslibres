{% extends "base.html" %}

{% block title %}Iniciar Sesión - TurnosLibres.com{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white rounded-xl shadow-sm p-6 sm:p-8 border border-gray-100">
  <!-- Header / Brand -->
  <div class="text-center mb-6">
    <div class="mx-auto h-12 w-12 rounded-full bg-blue-50 flex items-center justify-center mb-3">
      <!-- Calendar icon -->
      <svg class="h-6 w-6 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M3 11h18M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2Z" />
      </svg>
    </div>
    <h1 class="text-2xl font-semibold text-gray-900">Iniciar sesión</h1>
    <p class="text-gray-600 text-sm mt-1">Accedé a tu panel de administración</p>
  </div>

  <form method="POST" novalidate id="login-form">
    {{ form.hidden_tag() }}

    <!-- Email -->
    <div class="mb-4">
      {{ form.email.label(class="form-label") }}
      <div class="relative">
        <div class="pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center">
          <!-- Mail icon -->
          <svg class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7Zm0 0 9 6 9-6" />
          </svg>
        </div>
        {{ form.email(
          class="form-input pl-10",
          autocomplete="email",
          aria_invalid="true" if form.email.errors else None,
          aria_describedby="email-error" if form.email.errors else None
        ) }}
      </div>
      {% if form.email.errors %}
        <div id="email-error" class="text-red-600 text-sm mt-1">
          {% for error in form.email.errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Password -->
    <div class="mb-2">
      {{ form.password.label(class="form-label") }}
      <div class="relative">
        <div class="pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center">
          <!-- Lock icon -->
          <svg class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 1 0-8 0v4m-2 0h12v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8Z" />
          </svg>
        </div>
        {{ form.password(
          class="form-input pl-10 pr-10",
          id="password",
          autocomplete="current-password",
          aria_invalid="true" if form.password.errors else None,
          aria_describedby="password-error" if form.password.errors else None
        ) }}
        <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600" aria-label="Mostrar u ocultar contraseña">
          <!-- Eye icon -->
          <svg id="eye-icon" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7-9.5-7-9.5-7Z"/>
            <circle cx="12" cy="12" r="3" />
          </svg>
        </button>
      </div>
      {% if form.password.errors %}
        <div id="password-error" class="text-red-600 text-sm mt-1">
          {% for error in form.password.errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Remember me -->
    <div class="mb-6">
      <label class="flex items-center select-none">
        {{ form.remember_me(class="mr-2") }}
        <span class="text-sm text-gray-700">Recordarme</span>
      </label>
    </div>

    <!-- Submit -->
    <div class="mb-2">
      <button type="submit" id="submit-btn" class="w-full btn-primary flex items-center justify-center gap-2">
        <svg id="loading-spinner" class="h-4 w-4 animate-spin hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M12 3a9 9 0 1 1-9 9" stroke-linecap="round" />
        </svg>
        <span id="submit-text">Iniciar sesión</span>
      </button>
    </div>
  </form>

  <div class="text-center mt-4">
    <p class="text-gray-600 text-sm">
      ¿No tenés cuenta?
      <a href="{{ url_for('admin.register') }}" class="text-blue-600 hover:text-blue-800 font-medium">Registrate acá</a>
    </p>
  </div>
</div>

<script>
  (function () {
    var form = document.getElementById('login-form');
    var submitBtn = document.getElementById('submit-btn');
    var submitText = document.getElementById('submit-text');
    var spinner = document.getElementById('loading-spinner');
    var toggleBtn = document.getElementById('toggle-password');
    var pwd = document.getElementById('password');

    if (toggleBtn && pwd) {
      toggleBtn.addEventListener('click', function () {
        var isPwd = pwd.getAttribute('type') === 'password';
        pwd.setAttribute('type', isPwd ? 'text' : 'password');
      });
    }

    if (form) {
      form.addEventListener('submit', function () {
        if (submitBtn && spinner && submitText) {
          submitBtn.setAttribute('disabled', 'disabled');
          spinner.classList.remove('hidden');
          submitText.textContent = 'Ingresando…';
        }
      });
    }
  })();
  // Fin: JS mínimo para UX del login
</script>
{% endblock %}

